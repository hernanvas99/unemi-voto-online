import{d as E,r as u,A as Q,_ as A,o as U,S as y,g as i,f as r,as as k,e as l,Q as p,i as $,h as V,at as B,W as z,c as D,au as M,av as R,aw as O,U as _,T as I,X as L}from"./index.2c7c5b43.js";import{Q as G}from"./QSpace.9c94e2bb.js";import{a as H,Q as P}from"./QTable.200aae8f.js";import{Q as N}from"./QBadge.d2a8fc0c.js";import{Q as W}from"./QPage.152e8f99.js";import{u as j,A as w}from"./Api.b16e05d9.js";import{Q as T}from"./QSelect.cd845e3e.js";import{Q as F}from"./QForm.8d724ed1.js";import{u as X}from"./useRolPermisos.72458214.js";import{u as J}from"./useHelpers.e401e0ad.js";import"./QList.f8aa654c.js";import"./use-fullscreen.36e0f58f.js";import"./index.2cf0d985.js";import"./QItem.3a1f1059.js";import"./rtl.b51694b1.js";import"./auth-user.3faec0ee.js";const K=E({name:"AgregarUsuario",setup(e,{emit:o}){const m=u({rol_id:"",nombres:"",apellidos:"",cedula:"",celular:"",email:"",password:"",confirmPassword:""}),f=u([]),c=u(!1),b=j();(async()=>{try{const{data:{roles:a}}=await w.get("/roles");f.value=[],a.forEach(d=>{f.value.push({label:d.nombre,value:d.id})})}catch(a){alert(a)}})();const g=async()=>{if(m.value.password!==m.value.confirmPassword)return alert("Las contrase\xF1as no son iguales");try{c.value=!0,await w.post("/usuarios",m.value),o("actualizarLista"),b.notify({color:"positive",message:"Usuario Agregado Exitosamente",icon:"done"}),c.value=!1}catch(a){c.value=!1,b.notify({color:"warning",message:a.response.data.errors[0].msg,position:"top-right"})}};return Q(m.value,(a,d)=>{m.value.nombres=a.nombres.toUpperCase(),m.value.apellidos=a.apellidos.toUpperCase()}),{listRoles:f,loading:c,formUsuario:m,onSubmit:g,isPwd:u(!0),isPwd2:u(!0)}}}),Y=l("div",{class:"text-h6"},"Agregar Usuario",-1),Z={class:"row q-gutter-sm justify-around"},x={class:"col-xs-12 col-sm-5"},ee=l("label",null,"Nombres:",-1),oe={class:"col-xs-12 col-sm-5"},le=l("label",null,"Apellidos:",-1),se={class:"col-xs-12 col-sm-5 q-my-md"},ae=l("label",null,"Cedula:",-1),re={class:"col-xs-12 col-sm-5 q-my-md"},ie=l("label",null,"Celular:",-1),de={class:"col-xs-12 col-sm-5 q-my-md"},te=l("label",null,"Email:",-1),ne={class:"col-xs-12 col-sm-5 q-my-md"},ue=l("label",null,"Rol:",-1),me={class:"col-xs-12 col-sm-5 q-my-md"},pe=l("label",null,"Contrase\xF1a:",-1),ce={class:"col-xs-12 col-sm-5 q-my-md"},fe=l("label",null,"Confirmar Contrase\xF1a:",-1),ve={class:"col-xs-9 col-sm-12 flex justify-center"};function Ue(e,o,m,f,c,b){return U(),y(B,{style:{width:"700px","max-width":"80vw"}},{default:i(()=>[r(k,null,{default:i(()=>[Y]),_:1}),r(k,null,{default:i(()=>[r(F,{onSubmit:e.onSubmit},{default:i(()=>[l("div",Z,[l("div",x,[ee,r(p,{modelValue:e.formUsuario.nombres,"onUpdate:modelValue":o[0]||(o[0]=s=>e.formUsuario.nombres=s),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",oe,[le,r(p,{modelValue:e.formUsuario.apellidos,"onUpdate:modelValue":o[1]||(o[1]=s=>e.formUsuario.apellidos=s),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",se,[ae,r(p,{modelValue:e.formUsuario.cedula,"onUpdate:modelValue":o[2]||(o[2]=s=>e.formUsuario.cedula=s),modelModifiers:{trim:!0},minlength:"10",maxlength:"10",type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",re,[ie,r(p,{modelValue:e.formUsuario.celular,"onUpdate:modelValue":o[3]||(o[3]=s=>e.formUsuario.celular=s),modelModifiers:{trim:!0},type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",de,[te,r(p,{modelValue:e.formUsuario.email,"onUpdate:modelValue":o[4]||(o[4]=s=>e.formUsuario.email=s),modelModifiers:{trim:!0},type:"email",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",ne,[ue,r(T,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:e.formUsuario.rol_id,"onUpdate:modelValue":o[5]||(o[5]=s=>e.formUsuario.rol_id=s),options:e.listRoles},null,8,["modelValue","options"])]),l("div",me,[pe,r(p,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.password,"onUpdate:modelValue":o[7]||(o[7]=s=>e.formUsuario.password=s),modelModifiers:{trim:!0},type:e.isPwd?"password":"text",required:""},{append:i(()=>[r($,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[6]||(o[6]=s=>e.isPwd=!e.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",ce,[fe,r(p,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.confirmPassword,"onUpdate:modelValue":o[9]||(o[9]=s=>e.formUsuario.confirmPassword=s),modelModifiers:{trim:!0},type:e.isPwd2?"password":"text",required:""},{append:i(()=>[r($,{name:e.isPwd2?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[8]||(o[8]=s=>e.isPwd2=!e.isPwd2)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",ve,[r(V,{label:"Guardar",class:"q-px-xl",loading:e.loading,type:"submit",color:"green-9"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var be=A(K,[["render",Ue]]);const ye=E({name:"EditarUsuario",props:["userData"],setup(e,{emit:o}){const{id:m,nombres:f,apellidos:c,cedula:b,celular:s,email:g,rol_id:a}=e.userData,d=u(!1),v=u({rol_id:"",nombres:f,apellidos:c,cedula:b,celular:s,email:g,password:"",confirmPassword:""}),C=u([]),h=j();(async()=>{try{const{data:{roles:t}}=await w.get("/roles");C.value=[],t.forEach(q=>{C.value.push({label:q.nombre,value:q.id})}),v.value.rol_id=a}catch(t){alert(t)}})();const n=async()=>{if(v.value.password.length!==0&&v.value.password!==v.value.confirmPassword)return alert("Las contrase\xF1as no son iguales");try{d.value=!0,await w.put(`/usuarios/${m}`,v.value),o("actualizarLista"),h.notify({color:"positive",message:"Usuario Editado Exitosamente",icon:"done"}),d.value=!1}catch(t){d.value=!1,h.notify({color:"warning",message:t.response.data.errors[0].msg,position:"top-right"})}};return Q(v.value,(t,q)=>{v.value.nombres=t.nombres.toUpperCase(),v.value.apellidos=t.apellidos.toUpperCase()}),{listRoles:C,loading:d,formUsuario:v,onSubmit:n,isPwd:u(!0),isPwd2:u(!0)}}}),ge=l("div",{class:"text-h6"},"Editar Usuario",-1),we={class:"row q-gutter-sm justify-around"},Ve={class:"col-xs-12 col-sm-5"},$e=l("label",null,"Nombres:",-1),Ce={class:"col-xs-12 col-sm-5"},qe=l("label",null,"Apellidos:",-1),he={class:"col-xs-12 col-sm-5 q-my-md"},_e=l("label",null,"Cedula:",-1),Pe={class:"col-xs-12 col-sm-5 q-my-md"},ke=l("label",null,"Celular:",-1),Ee={class:"col-xs-12 col-sm-5 q-my-md"},Qe=l("label",null,"Email:",-1),Ae={class:"col-xs-12 col-sm-5 q-my-md"},Se=l("label",null,"Rol:",-1),ze={class:"col-xs-12 col-sm-5 q-my-md"},De=l("label",null,"Cambiar Contrase\xF1a (Opcional):",-1),Me={class:"col-xs-12 col-sm-5 q-my-md"},Re=l("label",null,"Confirmar Contrase\xF1a:",-1),Ie={class:"col-xs-9 col-sm-12 flex justify-center"};function Le(e,o,m,f,c,b){return U(),y(B,{style:{width:"700px","max-width":"80vw"}},{default:i(()=>[r(k,null,{default:i(()=>[ge]),_:1}),r(k,null,{default:i(()=>[r(F,{onSubmit:e.onSubmit},{default:i(()=>[l("div",we,[l("div",Ve,[$e,r(p,{modelValue:e.formUsuario.nombres,"onUpdate:modelValue":o[0]||(o[0]=s=>e.formUsuario.nombres=s),dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Ce,[qe,r(p,{modelValue:e.formUsuario.apellidos,"onUpdate:modelValue":o[1]||(o[1]=s=>e.formUsuario.apellidos=s),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",he,[_e,r(p,{modelValue:e.formUsuario.cedula,"onUpdate:modelValue":o[2]||(o[2]=s=>e.formUsuario.cedula=s),modelModifiers:{trim:!0},minlength:"10",maxlength:"10",type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Pe,[ke,r(p,{modelValue:e.formUsuario.celular,"onUpdate:modelValue":o[3]||(o[3]=s=>e.formUsuario.celular=s),modelModifiers:{trim:!0},type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Ee,[Qe,r(p,{modelValue:e.formUsuario.email,"onUpdate:modelValue":o[4]||(o[4]=s=>e.formUsuario.email=s),modelModifiers:{trim:!0},type:"email",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Ae,[Se,r(T,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:e.formUsuario.rol_id,"onUpdate:modelValue":o[5]||(o[5]=s=>e.formUsuario.rol_id=s),options:e.listRoles},null,8,["modelValue","options"])]),l("div",ze,[De,r(p,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.password,"onUpdate:modelValue":o[7]||(o[7]=s=>e.formUsuario.password=s),modelModifiers:{trim:!0},type:e.isPwd?"password":"text"},{append:i(()=>[r($,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[6]||(o[6]=s=>e.isPwd=!e.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",Me,[Re,r(p,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.confirmPassword,"onUpdate:modelValue":o[9]||(o[9]=s=>e.formUsuario.confirmPassword=s),modelModifiers:{trim:!0},type:e.isPwd2?"password":"text"},{append:i(()=>[r($,{name:e.isPwd2?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[8]||(o[8]=s=>e.isPwd2=!e.isPwd2)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",Ie,[r(V,{label:"Editar",class:"q-px-xl",loading:e.loading,type:"submit",color:"green-9"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var Ne=A(ye,[["render",Le]]);const Be=[{name:"id",label:"#",align:"left",field:"id",sortable:!0},{name:"usuario",label:"Usuario",align:"left",field:"usuario",sortable:!0},{name:"rol",align:"center",label:"Rol",field:"rol"},{name:"email",label:"Email",field:"email",align:"center"},{name:"cedula",label:"Cedula",field:"cedula",align:"center"},{name:"celular",label:"Celular",field:"celular",align:"center"},{name:"estado",label:"Estado",align:"center",field:"estado"},{name:"acciones",label:"acciones",align:"center"}],je=E({name:"IndexUsuario",components:{AgregarUsuario:be,EditarUsuario:Ne},setup(){const{validarPermisos:e}=X(),o=u(""),m=u([]),f=u(!0),{mostrarNotify:c}=J(),b=u(!1),s=u(!1),g=u({}),a=u({nombres:"",apellidos:"",cedula:"",celular:"",email:"",password:""}),d=async()=>{b.value=!1,s.value=!1,f.value=!0;try{const{data:{usuarios:n}}=await w.get("/usuarios");n.map(t=>t.usuario=`${t.nombres} ${t.apellidos}`),m.value=n}catch(n){alert(n)}f.value=!1};d();const v=async(n,t)=>{try{await w.delete(`/usuarios/${n}/${t}`),c("positive",`Usuario ${t?"Activado":"Inactivado"} exitosamente`),d()}catch(q){alert(q)}},C=async n=>{O.create({title:"\xBFDeseas Eliminar a este usuario?",message:"Una vez eliminado no podra recuperarse...!",ok:{push:!0,label:"Eliminar",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{await w.delete(`/usuarios/${n}`),c("positive","Usuario eliminado exitosamente"),d()}catch(t){c("negative",t.response.data.message)}})},h=async()=>{const n=await w.post("/usuarios",a.value);console.log(n)},S=n=>{g.value=n,s.value=!0};return Q(a.value,(n,t)=>{a.value.nombres=n.nombres.toUpperCase(),a.value.apellidos=n.apellidos.toUpperCase()}),{editarUsuario:S,eliminarUsuario:C,modalCrearUsuario:b,modalEditarUsuario:s,activarDesactivarUser:v,columns:Be,formUsuario:a,filter:o,loading:f,getUsuarios:d,onSubmit:h,rows:m,userData:g,validarPermisos:e}}}),Te={class:"row q-py-lg q-pl-md"},Fe=l("div",{class:"col-md-6"},[l("label",{class:"text-h6"},"Listado de Usuarios")],-1),Oe={class:"col-md-6 flex justify-end"},Ge={class:"row"},He={class:"col-md-12"},We={class:"q-pa-md"},Xe={class:"full-width row flex-center text-lime-10 q-gutter-sm"},Je=l("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun Resultado ",-1);function Ke(e,o,m,f,c,b){const s=z("AgregarUsuario"),g=z("EditarUsuario");return U(),D(R,null,[r(W,null,{default:i(()=>[l("div",Te,[Fe,l("div",Oe,[e.validarPermisos("Agregar Usuario")?(U(),y(V,{key:0,color:"secondary","icon-right":"person_add",label:"Agregar Usuario",class:"q-mr-md",onClick:o[0]||(o[0]=a=>e.modalCrearUsuario=!e.modalCrearUsuario)})):_("",!0)])]),l("div",Ge,[l("div",He,[l("div",We,[r(H,{class:"my-sticky-header-table",rows:e.rows,columns:e.columns,loading:e.loading,filter:e.filter,"row-key":"name"},{top:i(()=>[r(G),r(p,{dense:"",debounce:"300",color:"primary",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=a=>e.filter=a),label:"Buscar Usuario"},{append:i(()=>[r($,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-id":i(a=>[r(P,{props:a},{default:i(()=>[I(L(a.pageIndex+1),1)]),_:2},1032,["props"])]),"body-cell-pv":i(a=>[r(P,{props:a},{default:i(()=>[I(L(a.row.punto_venta),1)]),_:2},1032,["props"])]),"body-cell-estado":i(a=>[r(P,{props:a},{default:i(()=>[a.value?(U(),y(N,{key:0,outline:"",color:"positive",label:"Activo",class:"q-pa-sm"})):(U(),y(N,{key:1,outline:"",color:"red",label:"Inactivo",class:"q-pa-sm"}))]),_:2},1032,["props"])]),"body-cell-acciones":i(a=>[r(P,{props:a},{default:i(()=>[e.validarPermisos("Editar Usuario")&&a.row.estado?(U(),y(V,{key:0,round:"",color:"primary",onClick:d=>e.editarUsuario(a.row),icon:"edit",class:"q-mr-sm",size:"11px"},null,8,["onClick"])):_("",!0),a.row.estado&&e.validarPermisos("Inactivar Usuario")?(U(),y(V,{key:1,round:"",color:"blue-grey",icon:"close",onClick:d=>e.activarDesactivarUser(a.row.id,!1),size:"11px"},null,8,["onClick"])):(U(),D(R,{key:2},[!a.row.estado&&e.validarPermisos("Activar Usuario")?(U(),y(V,{key:0,round:"",color:"positive",class:"q-mr-sm",icon:"done",onClick:d=>e.activarDesactivarUser(a.row.id,!0),size:"11px"},null,8,["onClick"])):_("",!0),!a.row.estado&&e.validarPermisos("Eliminar Usuario")?(U(),y(V,{key:1,round:"",color:"deep-orange",icon:"delete",onClick:d=>e.eliminarUsuario(a.row.id),size:"11px"},null,8,["onClick"])):_("",!0)],64))]),_:2},1032,["props"])]),"no-data":i(({icon:a,filter:d})=>[l("div",Xe,[r($,{size:"2em",name:"sentiment_dissatisfied"}),Je,r($,{size:"2em",name:d?"filter_b_and_w":a},null,8,["name"])])]),_:1},8,["rows","columns","loading","filter"])])])])]),_:1}),r(M,{modelValue:e.modalCrearUsuario,"onUpdate:modelValue":o[2]||(o[2]=a=>e.modalCrearUsuario=a)},{default:i(()=>[r(s,{onActualizarLista:e.getUsuarios},null,8,["onActualizarLista"])]),_:1},8,["modelValue"]),r(M,{modelValue:e.modalEditarUsuario,"onUpdate:modelValue":o[3]||(o[3]=a=>e.modalEditarUsuario=a)},{default:i(()=>[r(g,{userData:e.userData,onActualizarLista:e.getUsuarios},null,8,["userData","onActualizarLista"])]),_:1},8,["modelValue"])],64)}var fo=A(je,[["render",Ke]]);export{fo as default};
