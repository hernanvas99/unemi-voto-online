import{Q as z}from"./QSelect.ff69d042.js";import{c as B,Q as D,a as N}from"./QItem.faa27fdc.js";import{Q as Y}from"./QList.aebb5a08.js";import{Q as Z}from"./QPage.4cf48411.js";import{_ as ee,d as te,r as n,A as ae,B as se,o as h,c as $,f as p,g as m,av as k,e,b7 as S,X as c,E as O,S as Q,T as oe,be as le,V as F}from"./index.86c036ad.js";import{l as ie}from"./index.013d7452.js";import{d as M,A as j}from"./dom-to-image.158f8a69.js";import{u as ne,A as V}from"./Api.0193aa3b.js";import"./rtl.b51694b1.js";import"./index.2cf0d985.js";const ce=te({name:"IndexResultados",setup(){const a=n([]),r=ne(),L=window.screen.width,g=n([]),C=n([]),y=n({cedula:"",candidato:""}),l=n(""),b=n([]),_=n([]),x=n([]);let E=0,f=null,w=n(0),P=n("----"),I=n("----"),q=n("----"),v=n("----");const T=n({series:[{data:_}],chart:{height:280,type:"bar",events:{click:function(t,i,o){o.dataPointIndex!=-1&&U(x.value[o.dataPointIndex],o.dataPointIndex)}}},colors:b,plotOptions:{bar:{columnWidth:"45%",distributed:!0}},dataLabels:{enabled:!0},legend:{show:!1},xaxis:{categories:x,labels:{style:{colors:b,fontSize:"12px"}}}}),G=async()=>{try{const{data:{aperturas:t}}=await V.get("/aperturas/all");t.forEach(i=>{i.estado&&(l.value=i.id),g.value.push({label:i.descripcion,value:i.id})}),R()}catch(t){alert(t)}},A=t=>Math.floor(Math.random()*t),H=async()=>{try{var t=document.querySelector("#chart"),i=document.querySelector("#comitiva");const d=g.value.find(K=>K.value==l.value);let u={estadistica:"",comitiva:"",fecha:P.value,horas:`${I.value} hasta ${q.value}`,totalVotos:w.value,numCandidatos:_.value.length,ganador:v.value,eleccionSelecta:d.label};r.loading.show({message:"Cargando..."});const J=await M.toPng(t),W=await M.toPng(i);u.estadistica=J,u.comitiva=W;const X=await V.post("/reportes/ganador",JSON.stringify(u),{responseType:"blob"});var o=new Blob([X.data],{type:"application/pdf"}),s=URL.createObjectURL(o);window.open(s),r.loading.hide()}catch(d){r.loading.hide(),alert(d)}},R=async()=>{try{b.value=[],x.value=[],_.value=[],w.value=0;const{data:{msg:t}}=await V.get(`/votaciones/votos/get/${l.value}`);a.value=t;let i=Math.max(...t.map(s=>parseInt(s.totalVotos))),o=t.filter(s=>s.totalVotos==i);if(o.length>0&&U(o[0].descripcion,null,o[0]),t.length>0){if(t[0].comenzo_votacion)v.value="Sin Empezar";else if(t[0].disponible&&!t[0].finalizo_votacion)v.value="En Proceso";else if(o.length==1&&(v.value=o[0].descripcion),o.length>1){let s="";o.forEach((d,u)=>{s+=` ${d.descripcion} ${u+1==o.length?"":","}`}),v.value=`Empate entre las listas ${s}`}}for(let s=0;s<t.length;s++)b.value.push(`rgb(${A(256)}, ${A(256)}, ${A(256)})`),x.value.push(t[s].descripcion),_.value.push(t[s].totalVotos),w.value+=t[s].totalVotos;if(t.length!=0){let s=t[0].fecha_inicio.split("T"),d=t[0].hora_inicio.split(":"),u=t[0].hora_fin.split(":");P.value=`${s[0].split("-")[2]}/${s[0].split("-")[1]}/${s[0].split("-")[0]}`,I.value=`${d[0]}:${d[1]}${parseInt(d[0])<12?"am":"pm"}`,q.value=`${u[0]}:${u[1]}${parseInt(q[0])<12?"am":"pm"}`}E==0?(f=new j(document.querySelector("#chart"),T.value),f.render()):(f.destroy(),f=new j(document.querySelector("#chart"),T.value),f.render()),E++}catch(t){alert(t)}},U=async(t,i=null,o=null)=>{try{const{data:{msg:s}}=await V.get(`/votaciones/votos/getComitiva/${l.value}/${t}`);y.value=i!=null?a.value[i]:o,y.value.lista=t,C.value=s}catch(s){alert(s)}};return ae(l,(t,i)=>{E!=0&&R()}),se(()=>{G();const t=ie("http://localhost:3000");t.on("connect",()=>{console.log("conectado")}),t.on("actualizar-grafica",i=>{R()})}),{anchoPantalla:L,arrayAperturas:g,fecha_inicio:P,hora_inicio:I,hora_fin:q,ganador:v,apertura_id:l,getPDF:H,data:_,listComitivaCandidato:C,presidenteSelected:y,totalVotos:w}}}),de={class:"row q-py-lg q-pl-md"},re=e("div",{class:"col-md-6 col-xs-12 text-center"},[e("label",{class:"text-h6"},"RESULTADOS ELECTORALES")],-1),ue=e("div",{class:"col-xs-12 text-center flex justify-center q-py-xs"},[e("label",{class:"text-h6"},"Filtrar por elecciones:")],-1),me={class:"col-xs-12 text-center flex justify-center"},he={key:1,class:"col-md-6 col-xs-12 flex justify-end"},pe=e("label",{class:"flex flex-center q-pr-md text-weight-medium text-body2"}," Filtrar por elecciones: ",-1),ve={class:"row"},_e=e("div",{style:{width:"100%",height:"300px"},id:"chart"},null,-1),fe=[_e],ge=e("label",{class:"flex flex-center text-h6"},"Detalles:",-1),ye=e("div",{class:"text-subtitle1 q-my-sm col-6 text-weight-medium"},"Fecha de votacion:",-1),be={class:"text-subtitle1 q-my-sm col-6"},xe=e("div",{class:"text-subtitle1 q-my-sm col-6 text-weight-medium"},"Horas de votacion:",-1),we={class:"text-subtitle1 q-my-sm col-6"},qe=e("div",{class:"text-subtitle1 q-my-sm col-6 text-weight-medium"},"Total de votos:",-1),$e={class:"text-subtitle1 q-my-sm col-6"},Se=e("div",{class:"text-subtitle1 q-my-sm col-6 text-weight-medium"},"N\xB0 de Candidatos:",-1),Ve={class:"text-subtitle1 q-my-sm col-6"},Ce=e("div",{class:"text-subtitle1 q-my-sm col-6 text-weight-medium flex flex-center"},"Ganador:",-1),Ee={class:"text-subtitle1 q-my-sm col-6"},Pe={class:"row",id:"comitiva"},Ie={class:"text-weight-bold"},Ae={class:"row"},Re={class:"col-3"},ke={class:"col-6"},Qe={class:"col-3"},Le={class:"row"},Te={class:"col-3"},Ue={class:"col-6"},ze={class:"col-3"},Be=e("div",{id:"captura"},null,-1);function De(a,r,L,g,C,y){return h(),$(k,null,[p(Z,null,{default:m(()=>[e("div",de,[re,a.anchoPantalla<500?(h(),$(k,{key:0},[ue,e("div",me,[p(z,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:a.apertura_id,"onUpdate:modelValue":r[0]||(r[0]=l=>a.apertura_id=l),options:a.arrayAperturas,style:{width:"80%"},class:"q-mr-lg"},null,8,["modelValue","options"])])],64)):(h(),$("div",he,[pe,p(z,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:a.apertura_id,"onUpdate:modelValue":r[1]||(r[1]=l=>a.apertura_id=l),options:a.arrayAperturas,style:{width:"50%"},class:"q-mr-lg"},null,8,["modelValue","options"])]))]),e("div",ve,[e("div",{class:S(["col-md-7 col-xs-12",a.anchoPantalla>500?"q-ml-lg":""])},fe,2),e("div",{class:S(["col-md-4 col-xs-12",a.anchoPantalla>500?"q-ml-lg q-my-md":"q-ml-md"])},[ge,e("div",{class:S(["row",a.anchoPantalla>500?"q-pb-xl":"q-pb-md"])},[ye,e("div",be,c(a.fecha_inicio),1),xe,e("div",we,c(a.hora_inicio)+" hasta "+c(a.hora_fin),1),qe,e("div",$e,c(a.totalVotos),1),Se,e("div",Ve,c(a.data.length),1),Ce,e("div",Ee,c(a.ganador),1)],2)],2)]),e("div",Pe,[e("div",{class:S(["col-md-7 col-xs-12",a.anchoPantalla>500?"offset-2":""])},[p(Y,{bordered:"",separator:""},{default:m(()=>[O((h(),Q(D,{clickable:"",class:"bg-blue-grey-6 text-white flex flex-center"},{default:m(()=>[p(B,{class:"text-center flex flex-center",style:{display:"inline"}},{default:m(()=>[oe("COMITIVA - "),e("label",Ie,c(a.presidenteSelected.lista),1)]),_:1})]),_:1})),[[F]]),O((h(),Q(D,{clickable:""},{default:m(()=>[p(B,null,{default:m(()=>[p(N,null,{default:m(()=>[e("div",Ae,[e("div",Re,c(a.presidenteSelected.cedula==""?"----":a.presidenteSelected.cedula),1),e("div",ke,c(a.presidenteSelected.candidato==""?"----":a.presidenteSelected.candidato),1),e("div",Qe,c(a.presidenteSelected.candidato==""?"----":"PRESIDENTE"),1)])]),_:1}),(h(!0),$(k,null,le(a.listComitivaCandidato,l=>(h(),Q(N,{key:l},{default:m(()=>[e("div",Le,[e("div",Te,c(l.cedula),1),e("div",Ue,c(l.candidato),1),e("div",ze,c(l.nombre),1)])]),_:2},1024))),128))]),_:1})]),_:1})),[[F]])]),_:1})],2)])]),_:1}),Be],64)}var Ke=ee(ce,[["render",De]]);export{Ke as default};
