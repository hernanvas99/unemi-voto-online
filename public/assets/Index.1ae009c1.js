import{Q as K}from"./QSelect.ff69d042.js";import{_ as Y,d as Z,r as i,A as ee,B as te,o as g,c as L,f as h,g as u,av as T,e as t,X as c,T as D,i as ae,E as z,S as k,be as se,V as B}from"./index.86c036ad.js";import{c as N,Q as O,a as U}from"./QItem.faa27fdc.js";import{Q as oe}from"./QList.aebb5a08.js";import{Q as le}from"./QPage.4cf48411.js";import{l as ie}from"./index.013d7452.js";import{u as ce}from"./useRolPermisos.1ee2517c.js";import{u as ne}from"./useHelpers.4fa72bec.js";import{d as F,A as M}from"./dom-to-image.158f8a69.js";import{u as re,A as S}from"./Api.0193aa3b.js";import"./rtl.b51694b1.js";import"./auth-user.43655eae.js";import"./index.2cf0d985.js";const de=Z({name:"IndexResultados",setup(){const s=i([]);ne();const p=re(),y=i([]),V=i([]),b=i({cedula:"",candidato:""}),m=i(""),{validarPermisos:r}=ce(),x=i([]),_=i([]),w=i([]);let I=0,f=null,q=i(0),C=i("----"),E=i("----"),$=i("----"),v=i("----");const A=i({series:[{data:_}],chart:{height:280,type:"bar",events:{click:function(e,l,o){o.dataPointIndex!=-1&&R(w.value[o.dataPointIndex],o.dataPointIndex)}}},colors:x,plotOptions:{bar:{columnWidth:"45%",distributed:!0}},dataLabels:{enabled:!0},legend:{show:!1},xaxis:{categories:w,labels:{style:{colors:x,fontSize:"12px"}}}}),j=async()=>{try{const{data:{aperturas:e}}=await S.get("/aperturas/all");e.forEach(l=>{l.estado&&(m.value=l.id),y.value.push({label:l.descripcion,value:l.id})}),Q()}catch(e){alert(e)}},P=e=>Math.floor(Math.random()*e),H=async()=>{try{var e=document.querySelector("#chart"),l=document.querySelector("#comitiva");const n=y.value.find(X=>X.value==m.value);let d={estadistica:"",comitiva:"",fecha:C.value,horas:`${E.value} hasta ${$.value}`,totalVotos:q.value,numCandidatos:_.value.length,ganador:v.value,eleccionSelecta:n.label};p.loading.show({message:"Cargando..."});const G=await F.toPng(e),J=await F.toPng(l);d.estadistica=G,d.comitiva=J;const W=await S.post("/reportes/ganador",JSON.stringify(d),{responseType:"blob"});var o=new Blob([W.data],{type:"application/pdf"}),a=URL.createObjectURL(o);window.open(a),p.loading.hide()}catch(n){p.loading.hide(),alert(n)}},Q=async()=>{try{x.value=[],w.value=[],_.value=[],q.value=0;const{data:{msg:e}}=await S.get(`/votaciones/votos/get/${m.value}`);s.value=e;let l=Math.max(...e.map(a=>parseInt(a.totalVotos))),o=e.filter(a=>a.totalVotos==l);if(o.length>0&&R(o[0].descripcion,null,o[0]),e.length>0){if(e[0].comenzo_votacion)v.value="Sin Empezar";else if(e[0].disponible&&!e[0].finalizo_votacion)v.value="En Proceso";else if(o.length==1&&(v.value=o[0].descripcion),o.length>1){let a="";o.forEach((n,d)=>{a+=` ${n.descripcion} ${d+1==o.length?"":","}`}),v.value=`Empate entre las listas ${a}`}}for(let a=0;a<e.length;a++)x.value.push(`rgb(${P(256)}, ${P(256)}, ${P(256)})`),w.value.push(e[a].descripcion),_.value.push(e[a].totalVotos),q.value+=e[a].totalVotos;if(e.length!=0){let a=e[0].fecha_inicio.split("T"),n=e[0].hora_inicio.split(":"),d=e[0].hora_fin.split(":");C.value=`${a[0].split("-")[2]}/${a[0].split("-")[1]}/${a[0].split("-")[0]}`,E.value=`${n[0]}:${n[1]}${parseInt(n[0])<12?"am":"pm"}`,$.value=`${d[0]}:${d[1]}${parseInt($[0])<12?"am":"pm"}`}I==0?(f=new M(document.querySelector("#chart"),A.value),f.render()):(f.destroy(),f=new M(document.querySelector("#chart"),A.value),f.render()),I++}catch(e){alert(e)}},R=async(e,l=null,o=null)=>{try{const{data:{msg:a}}=await S.get(`/votaciones/votos/getComitiva/${m.value}/${e}`);b.value=l!=null?s.value[l]:o,b.value.lista=e,V.value=a}catch(a){alert(a)}};return ee(m,(e,l)=>{I!=0&&Q()}),te(()=>{j();const e=ie("http://localhost:3000");e.on("connect",()=>{console.log("conectado")}),e.on("actualizar-grafica",l=>{Q()})}),{arrayAperturas:y,fecha_inicio:C,hora_inicio:E,hora_fin:$,ganador:v,apertura_id:m,getPDF:H,data:_,listComitivaCandidato:V,presidenteSelected:b,validarPermisos:r,totalVotos:q}}}),ue={class:"row q-py-lg q-pl-md"},me=t("div",{class:"col-md-6"},[t("label",{class:"text-h6"},"RESULTADOS ELECTORALES")],-1),he={class:"col-md-6 flex justify-end"},pe=t("label",{class:"flex flex-center q-pr-md text-weight-medium text-body2"}," Filtrar por elecciones: ",-1),ve={class:"row"},_e=t("div",{class:"col-7 q-ml-lg"},[t("div",{style:{width:"100%",height:"300px"},id:"chart"})],-1),fe={class:"col-4 q-my-md q-ml-lg"},ge=t("label",{class:"flex flex-center text-h6"},"Detalles:",-1),ye={class:"row q-pb-xl"},be=t("div",{class:"text-subtitle1 q-my-sm col-6 text-weight-medium"},"Fecha de votacion:",-1),xe={class:"text-subtitle1 q-my-sm col-6"},we=t("div",{class:"text-subtitle1 q-my-sm col-6 text-weight-medium"},"Horas de votacion:",-1),qe={class:"text-subtitle1 q-my-sm col-6"},$e=t("div",{class:"text-subtitle1 q-my-sm col-6 text-weight-medium"},"Total de votos:",-1),Se={class:"text-subtitle1 q-my-sm col-6"},Ve=t("div",{class:"text-subtitle1 q-my-sm col-6 text-weight-medium"},"N\xB0 de Candidatos:",-1),Ie={class:"text-subtitle1 q-my-sm col-6"},Ce=t("div",{class:"text-subtitle1 q-my-sm col-6 text-weight-medium flex flex-center"},"Ganador:",-1),Ee={class:"text-subtitle1 q-my-sm col-6"},Pe={class:"row",id:"comitiva"},Qe={class:"col-7 offset-2"},ke={class:"text-weight-bold"},Ae={class:"row"},Re={class:"col-3"},Le={class:"col-6"},Te={class:"col-3"},De={class:"row"},ze={class:"col-3"},Be={class:"col-6"},Ne={class:"col-3"},Oe=t("div",{id:"captura"},null,-1);function Ue(s,p,y,V,b,m){return g(),L(T,null,[h(le,null,{default:u(()=>[t("div",ue,[me,t("div",he,[pe,h(K,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:s.apertura_id,"onUpdate:modelValue":p[0]||(p[0]=r=>s.apertura_id=r),options:s.arrayAperturas,style:{width:"50%"},class:"q-mr-lg"},null,8,["modelValue","options"])])]),t("div",ve,[_e,t("div",fe,[ge,t("div",ye,[be,t("div",xe,c(s.fecha_inicio),1),we,t("div",qe,c(s.hora_inicio)+" hasta "+c(s.hora_fin),1),$e,t("div",Se,c(s.totalVotos),1),Ve,t("div",Ie,c(s.data.length),1),Ce,t("div",Ee,[D(c(s.ganador)+" ",1),h(ae,{name:"picture_as_pdf",class:"q-ml-md",color:"red-9",size:"24px",onClick:s.getPDF},null,8,["onClick"])])])])]),t("div",Pe,[t("div",Qe,[h(oe,{bordered:"",separator:""},{default:u(()=>[z((g(),k(O,{clickable:"",class:"bg-blue-grey-6 text-white flex flex-center"},{default:u(()=>[h(N,{class:"text-center flex flex-center",style:{display:"inline"}},{default:u(()=>[D("COMITIVA - "),t("label",ke,c(s.presidenteSelected.lista),1)]),_:1})]),_:1})),[[B]]),z((g(),k(O,{clickable:""},{default:u(()=>[h(N,null,{default:u(()=>[h(U,null,{default:u(()=>[t("div",Ae,[t("div",Re,c(s.presidenteSelected.cedula==""?"----":s.presidenteSelected.cedula),1),t("div",Le,c(s.presidenteSelected.candidato==""?"----":s.presidenteSelected.candidato),1),t("div",Te,c(s.presidenteSelected.candidato==""?"----":"PRESIDENTE"),1)])]),_:1}),(g(!0),L(T,null,se(s.listComitivaCandidato,r=>(g(),k(U,{key:r},{default:u(()=>[t("div",De,[t("div",ze,c(r.cedula),1),t("div",Be,c(r.candidato),1),t("div",Ne,c(r.nombre),1)])]),_:2},1024))),128))]),_:1})]),_:1})),[[B]])]),_:1})])])]),_:1}),Oe],64)}var at=Y(de,[["render",Ue]]);export{at as default};
