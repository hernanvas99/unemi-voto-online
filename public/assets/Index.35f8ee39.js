import{d as E,r as n,A as Q,_ as A,o as U,S as y,g as i,f as a,as as _,e as l,Q as m,i as $,h as V,at as j,W as S,c as D,au as M,av as R,aw as H,b7 as I,U as q,T as L,X as N}from"./index.86c036ad.js";import{Q as W}from"./QSpace.3a2d759c.js";import{a as X,Q as P}from"./QTable.29ed5419.js";import{Q as B}from"./QBadge.265b8235.js";import{Q as J}from"./QPage.4cf48411.js";import{u as T,A as w}from"./Api.0193aa3b.js";import{Q as F}from"./QSelect.ff69d042.js";import{Q as O}from"./QForm.dbcce163.js";import{u as K}from"./useRolPermisos.1ee2517c.js";import{u as Y}from"./useHelpers.4fa72bec.js";import"./QList.aebb5a08.js";import"./use-fullscreen.7000f2af.js";import"./index.2cf0d985.js";import"./QItem.faa27fdc.js";import"./rtl.b51694b1.js";import"./auth-user.43655eae.js";const Z=E({name:"AgregarUsuario",setup(e,{emit:o}){const u=n({rol_id:"",nombres:"",apellidos:"",cedula:"",celular:"",email:"",password:"",confirmPassword:""}),v=n([]),c=n(!1),b=T();(async()=>{try{const{data:{roles:r}}=await w.get("/roles");v.value=[],r.forEach(d=>{v.value.push({label:d.nombre,value:d.id})})}catch(r){alert(r)}})();const g=async()=>{if(u.value.password!==u.value.confirmPassword)return alert("Las contrase\xF1as no son iguales");try{c.value=!0,await w.post("/usuarios",u.value),o("actualizarLista"),b.notify({color:"positive",message:"Usuario Agregado Exitosamente",icon:"done"}),c.value=!1}catch(r){c.value=!1,b.notify({color:"warning",message:r.response.data.errors[0].msg,position:"top-right"})}};return Q(u.value,(r,d)=>{u.value.nombres=r.nombres.toUpperCase(),u.value.apellidos=r.apellidos.toUpperCase()}),{listRoles:v,loading:c,formUsuario:u,onSubmit:g,isPwd:n(!0),isPwd2:n(!0)}}}),x=l("div",{class:"text-h6"},"Agregar Usuario",-1),ee={class:"row q-gutter-sm justify-around"},oe={class:"col-xs-12 col-sm-5"},le=l("label",null,"Nombres:",-1),se={class:"col-xs-12 col-sm-5"},ae=l("label",null,"Apellidos:",-1),re={class:"col-xs-12 col-sm-5 q-my-md"},ie=l("label",null,"Cedula:",-1),te={class:"col-xs-12 col-sm-5 q-my-md"},de=l("label",null,"Celular:",-1),ne={class:"col-xs-12 col-sm-5 q-my-md"},ue=l("label",null,"Email:",-1),me={class:"col-xs-12 col-sm-5 q-my-md"},pe=l("label",null,"Rol:",-1),ce={class:"col-xs-12 col-sm-5 q-my-md"},fe=l("label",null,"Contrase\xF1a:",-1),ve={class:"col-xs-12 col-sm-5 q-my-md"},Ue=l("label",null,"Confirmar Contrase\xF1a:",-1),be={class:"col-xs-9 col-sm-12 flex justify-center"};function ye(e,o,u,v,c,b){return U(),y(j,{style:{width:"700px","max-width":"80vw"}},{default:i(()=>[a(_,null,{default:i(()=>[x]),_:1}),a(_,null,{default:i(()=>[a(O,{onSubmit:e.onSubmit},{default:i(()=>[l("div",ee,[l("div",oe,[le,a(m,{modelValue:e.formUsuario.nombres,"onUpdate:modelValue":o[0]||(o[0]=s=>e.formUsuario.nombres=s),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",se,[ae,a(m,{modelValue:e.formUsuario.apellidos,"onUpdate:modelValue":o[1]||(o[1]=s=>e.formUsuario.apellidos=s),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",re,[ie,a(m,{modelValue:e.formUsuario.cedula,"onUpdate:modelValue":o[2]||(o[2]=s=>e.formUsuario.cedula=s),modelModifiers:{trim:!0},minlength:"10",maxlength:"10",type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",te,[de,a(m,{modelValue:e.formUsuario.celular,"onUpdate:modelValue":o[3]||(o[3]=s=>e.formUsuario.celular=s),modelModifiers:{trim:!0},type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",ne,[ue,a(m,{modelValue:e.formUsuario.email,"onUpdate:modelValue":o[4]||(o[4]=s=>e.formUsuario.email=s),modelModifiers:{trim:!0},type:"email",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",me,[pe,a(F,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:e.formUsuario.rol_id,"onUpdate:modelValue":o[5]||(o[5]=s=>e.formUsuario.rol_id=s),options:e.listRoles},null,8,["modelValue","options"])]),l("div",ce,[fe,a(m,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.password,"onUpdate:modelValue":o[7]||(o[7]=s=>e.formUsuario.password=s),modelModifiers:{trim:!0},type:e.isPwd?"password":"text",required:""},{append:i(()=>[a($,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[6]||(o[6]=s=>e.isPwd=!e.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",ve,[Ue,a(m,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.confirmPassword,"onUpdate:modelValue":o[9]||(o[9]=s=>e.formUsuario.confirmPassword=s),modelModifiers:{trim:!0},type:e.isPwd2?"password":"text",required:""},{append:i(()=>[a($,{name:e.isPwd2?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[8]||(o[8]=s=>e.isPwd2=!e.isPwd2)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",be,[a(V,{label:"Guardar",class:"q-px-xl",loading:e.loading,type:"submit",color:"green-9"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var ge=A(Z,[["render",ye]]);const we=E({name:"EditarUsuario",props:["userData"],setup(e,{emit:o}){const{id:u,nombres:v,apellidos:c,cedula:b,celular:s,email:g,rol_id:r}=e.userData,d=n(!1),p=n({rol_id:"",nombres:v,apellidos:c,cedula:b,celular:s,email:g,password:"",confirmPassword:""}),C=n([]),h=T();(async()=>{try{const{data:{roles:t}}=await w.get("/roles");C.value=[],t.forEach(f=>{C.value.push({label:f.nombre,value:f.id})}),p.value.rol_id=r}catch(t){alert(t)}})();const k=async()=>{if(p.value.password.length!==0&&p.value.password!==p.value.confirmPassword)return alert("Las contrase\xF1as no son iguales");try{d.value=!0,await w.put(`/usuarios/${u}`,p.value),o("actualizarLista"),h.notify({color:"positive",message:"Usuario Editado Exitosamente",icon:"done"}),d.value=!1}catch(t){d.value=!1,h.notify({color:"warning",message:t.response.data.errors[0].msg,position:"top-right"})}};return Q(p.value,(t,f)=>{p.value.nombres=t.nombres.toUpperCase(),p.value.apellidos=t.apellidos.toUpperCase()}),{listRoles:C,loading:d,formUsuario:p,onSubmit:k,isPwd:n(!0),isPwd2:n(!0)}}}),Ve=l("div",{class:"text-h6"},"Editar Usuario",-1),$e={class:"row q-gutter-sm justify-around"},Ce={class:"col-xs-12 col-sm-5"},he=l("label",null,"Nombres:",-1),qe={class:"col-xs-12 col-sm-5"},Pe=l("label",null,"Apellidos:",-1),_e={class:"col-xs-12 col-sm-5 q-my-md"},ke=l("label",null,"Cedula:",-1),Ee={class:"col-xs-12 col-sm-5 q-my-md"},Qe=l("label",null,"Celular:",-1),Ae={class:"col-xs-12 col-sm-5 q-my-md"},ze=l("label",null,"Email:",-1),Se={class:"col-xs-12 col-sm-5 q-my-md"},De=l("label",null,"Rol:",-1),Me={class:"col-xs-12 col-sm-5 q-my-md"},Re=l("label",null,"Cambiar Contrase\xF1a (Opcional):",-1),Ie={class:"col-xs-12 col-sm-5 q-my-md"},Le=l("label",null,"Confirmar Contrase\xF1a:",-1),Ne={class:"col-xs-9 col-sm-12 flex justify-center"};function Be(e,o,u,v,c,b){return U(),y(j,{style:{width:"700px","max-width":"80vw"}},{default:i(()=>[a(_,null,{default:i(()=>[Ve]),_:1}),a(_,null,{default:i(()=>[a(O,{onSubmit:e.onSubmit},{default:i(()=>[l("div",$e,[l("div",Ce,[he,a(m,{modelValue:e.formUsuario.nombres,"onUpdate:modelValue":o[0]||(o[0]=s=>e.formUsuario.nombres=s),dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",qe,[Pe,a(m,{modelValue:e.formUsuario.apellidos,"onUpdate:modelValue":o[1]||(o[1]=s=>e.formUsuario.apellidos=s),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",_e,[ke,a(m,{modelValue:e.formUsuario.cedula,"onUpdate:modelValue":o[2]||(o[2]=s=>e.formUsuario.cedula=s),modelModifiers:{trim:!0},minlength:"10",maxlength:"10",type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Ee,[Qe,a(m,{modelValue:e.formUsuario.celular,"onUpdate:modelValue":o[3]||(o[3]=s=>e.formUsuario.celular=s),modelModifiers:{trim:!0},type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Ae,[ze,a(m,{modelValue:e.formUsuario.email,"onUpdate:modelValue":o[4]||(o[4]=s=>e.formUsuario.email=s),modelModifiers:{trim:!0},type:"email",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Se,[De,a(F,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:e.formUsuario.rol_id,"onUpdate:modelValue":o[5]||(o[5]=s=>e.formUsuario.rol_id=s),options:e.listRoles},null,8,["modelValue","options"])]),l("div",Me,[Re,a(m,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.password,"onUpdate:modelValue":o[7]||(o[7]=s=>e.formUsuario.password=s),modelModifiers:{trim:!0},type:e.isPwd?"password":"text"},{append:i(()=>[a($,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[6]||(o[6]=s=>e.isPwd=!e.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",Ie,[Le,a(m,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.confirmPassword,"onUpdate:modelValue":o[9]||(o[9]=s=>e.formUsuario.confirmPassword=s),modelModifiers:{trim:!0},type:e.isPwd2?"password":"text"},{append:i(()=>[a($,{name:e.isPwd2?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[8]||(o[8]=s=>e.isPwd2=!e.isPwd2)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",Ne,[a(V,{label:"Editar",class:"q-px-xl",loading:e.loading,type:"submit",color:"green-9"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var je=A(we,[["render",Be]]);const Te=[{name:"id",label:"#",align:"left",field:"id",sortable:!0},{name:"usuario",label:"Usuario",align:"left",field:"usuario",sortable:!0},{name:"rol",align:"center",label:"Rol",field:"rol"},{name:"email",label:"Email",field:"email",align:"center"},{name:"cedula",label:"Cedula",field:"cedula",align:"center"},{name:"celular",label:"Celular",field:"celular",align:"center"},{name:"estado",label:"Estado",align:"center",field:"estado"},{name:"acciones",label:"acciones",align:"center"}],Fe=E({name:"IndexUsuario",components:{AgregarUsuario:ge,EditarUsuario:je},setup(){const{validarPermisos:e}=K(),o=n(""),u=n([]),v=n(!0),{mostrarNotify:c}=Y(),b=n(!1),s=n(!1),g=n({}),r=window.screen.width,d=n({nombres:"",apellidos:"",cedula:"",celular:"",email:"",password:""}),p=async()=>{b.value=!1,s.value=!1,v.value=!0;try{const{data:{usuarios:t}}=await w.get("/usuarios");t.map(f=>f.usuario=`${f.nombres} ${f.apellidos}`),u.value=t}catch(t){alert(t)}v.value=!1};p();const C=async(t,f)=>{try{await w.delete(`/usuarios/${t}/${f}`),c("positive",`Usuario ${f?"Activado":"Inactivado"} exitosamente`),p()}catch(G){alert(G)}},h=async t=>{H.create({title:"\xBFDeseas Eliminar a este usuario?",message:"Una vez eliminado no podra recuperarse...!",ok:{push:!0,label:"Eliminar",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{await w.delete(`/usuarios/${t}`),c("positive","Usuario eliminado exitosamente"),p()}catch(f){c("negative",f.response.data.message)}})},z=async()=>{const t=await w.post("/usuarios",d.value);console.log(t)},k=t=>{g.value=t,s.value=!0};return Q(d.value,(t,f)=>{d.value.nombres=t.nombres.toUpperCase(),d.value.apellidos=t.apellidos.toUpperCase()}),{anchoPantalla:r,editarUsuario:k,eliminarUsuario:h,modalCrearUsuario:b,modalEditarUsuario:s,activarDesactivarUser:C,columns:Te,formUsuario:d,filter:o,loading:v,getUsuarios:p,onSubmit:z,rows:u,userData:g,validarPermisos:e}}}),Oe={class:"row q-py-lg q-pl-md"},Ge=l("label",{class:"text-h6"},"Listado de Usuarios",-1),He=[Ge],We={class:"row"},Xe={class:"col-md-12 col-xs-12"},Je={class:"q-pa-md"},Ke={class:"full-width row flex-center text-lime-10 q-gutter-sm"},Ye=l("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun Resultado ",-1);function Ze(e,o,u,v,c,b){const s=S("AgregarUsuario"),g=S("EditarUsuario");return U(),D(R,null,[a(J,null,{default:i(()=>[l("div",Oe,[l("div",{class:I(["col-md-6 col-xs-12",e.anchoPantalla<500?"text-center":""])},He,2),l("div",{class:I(["col-md-6 col-xs-12 flex",e.anchoPantalla<500?"justify-center q-pt-md":"justify-end"])},[e.validarPermisos("Agregar Usuario")?(U(),y(V,{key:0,color:"secondary","icon-right":"person_add",label:"Agregar Usuario",class:"q-mr-md",onClick:o[0]||(o[0]=r=>e.modalCrearUsuario=!e.modalCrearUsuario)})):q("",!0)],2)]),l("div",We,[l("div",Xe,[l("div",Je,[a(X,{class:"my-sticky-header-table",rows:e.rows,columns:e.columns,loading:e.loading,filter:e.filter,"row-key":"name"},{top:i(()=>[a(W),a(m,{dense:"",debounce:"300",color:"primary",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=r=>e.filter=r),label:"Buscar Usuario"},{append:i(()=>[a($,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-id":i(r=>[a(P,{props:r},{default:i(()=>[L(N(r.pageIndex+1),1)]),_:2},1032,["props"])]),"body-cell-pv":i(r=>[a(P,{props:r},{default:i(()=>[L(N(r.row.punto_venta),1)]),_:2},1032,["props"])]),"body-cell-estado":i(r=>[a(P,{props:r},{default:i(()=>[r.value?(U(),y(B,{key:0,outline:"",color:"positive",label:"Activo",class:"q-pa-sm"})):(U(),y(B,{key:1,outline:"",color:"red",label:"Inactivo",class:"q-pa-sm"}))]),_:2},1032,["props"])]),"body-cell-acciones":i(r=>[a(P,{props:r},{default:i(()=>[e.validarPermisos("Editar Usuario")&&r.row.estado?(U(),y(V,{key:0,round:"",color:"primary",onClick:d=>e.editarUsuario(r.row),icon:"edit",class:"q-mr-sm",size:"11px"},null,8,["onClick"])):q("",!0),r.row.estado&&e.validarPermisos("Inactivar Usuario")?(U(),y(V,{key:1,round:"",color:"blue-grey",icon:"close",onClick:d=>e.activarDesactivarUser(r.row.id,!1),size:"11px"},null,8,["onClick"])):(U(),D(R,{key:2},[!r.row.estado&&e.validarPermisos("Activar Usuario")?(U(),y(V,{key:0,round:"",color:"positive",class:"q-mr-sm",icon:"done",onClick:d=>e.activarDesactivarUser(r.row.id,!0),size:"11px"},null,8,["onClick"])):q("",!0),!r.row.estado&&e.validarPermisos("Eliminar Usuario")?(U(),y(V,{key:1,round:"",color:"deep-orange",icon:"delete",onClick:d=>e.eliminarUsuario(r.row.id),size:"11px"},null,8,["onClick"])):q("",!0)],64))]),_:2},1032,["props"])]),"no-data":i(({icon:r,filter:d})=>[l("div",Ke,[a($,{size:"2em",name:"sentiment_dissatisfied"}),Ye,a($,{size:"2em",name:d?"filter_b_and_w":r},null,8,["name"])])]),_:1},8,["rows","columns","loading","filter"])])])])]),_:1}),a(M,{modelValue:e.modalCrearUsuario,"onUpdate:modelValue":o[2]||(o[2]=r=>e.modalCrearUsuario=r)},{default:i(()=>[a(s,{onActualizarLista:e.getUsuarios},null,8,["onActualizarLista"])]),_:1},8,["modelValue"]),a(M,{modelValue:e.modalEditarUsuario,"onUpdate:modelValue":o[3]||(o[3]=r=>e.modalEditarUsuario=r)},{default:i(()=>[a(g,{userData:e.userData,onActualizarLista:e.getUsuarios},null,8,["userData","onActualizarLista"])]),_:1},8,["modelValue"])],64)}var Uo=A(Fe,[["render",Ze]]);export{Uo as default};
